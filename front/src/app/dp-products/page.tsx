"use client";
import { useSearchParams } from 'next/navigation';
import { FC, useEffect, useState, useContext } from 'react';
import { fetchProductById } from '../../../lib/mercadoLibreAPI';
import { Product } from '@/app/types/product';
import { Carousel } from 'flowbite-react';
import { Navbar } from '../components/navbar';
import { Footer } from '../components/footer';
import ProductShowcase from '../components/products-showcase';
import { CartContext } from '../context/cartcontext';
import CardFeedback from '../components/feedbacks';

const ProductPage: FC = () => {

  const cartContext = useContext(CartContext);

  const handleAddToCart = () => {
    if (cartContext) {
      cartContext.addToCart(product);
    }
  };

  <script src="../path/to/flowbite/dist/flowbite.min.js" async></script>

  const searchParams = useSearchParams();
  const [product, setProduct] = useState<Product | null>(null);

  useEffect(() => {
    const productId = searchParams.get('id');
    if (productId) {
      fetchProductById(productId).then(setProduct);
    }
  }, [searchParams]);

  if (!product) {
    return <div className='text-blackcontent text-center justify-center flex items-center h-screen'>Carregando...</div>;
  }

  return (
    <div className='bg-white'>
      <Navbar></Navbar>
      <div className='flex justify-center items-center max-my-36 my-20'>
        <div className='max-sm:flex-col gap-12 border-t-2 border-b-2 border-r-2 border-gray-200 rounded-tl-xl h-[500px] max-sm:h-[800px] w-[999px] rounded-tr-[90px] rounded-xl rounded-br-[90px] max-sm:w-[400px] max-sm:border-none text-blackcontent flex justify-center items-center'>
          {/* Carousel dos produtos*/}

          <Carousel indicators={false} className='w-[400px]'>
            {product.pictures.map((picture, index) => (
              <img key={index} className="w-[400px] mb-2" src={picture.url} alt={`${product.title} - ${index + 1}`} />
            ))}
          </Carousel>

          <div className='mx-4'>
            {/* Informações do produto */}
            <h1 className='font-light text-xl'>{product.title}</h1>
            {/* Estrelas */}
            <svg className='my-4' height="15" width="90" fill="none" viewBox="0 0 117 20" xmlns="http://www.w3.org/2000/svg">
              <path d="M68.1929 7.53603C68.0437 7.09188 67.6593 6.76805 67.1964 6.69725L61.809 5.87402L59.3892 0.719093C59.1828 0.2797 58.7419 0 58.2574 0C57.7726 0 57.3319 0.2797 57.1256 0.719093L54.7054 5.87434L49.3181 6.69757C48.8552 6.76837 48.4707 7.09188 48.3218 7.53635C48.1729 7.98082 48.2853 8.47038 48.6126 8.80627L52.5469 12.8405L51.6151 18.5478C51.5382 19.0203 51.7386 19.4952 52.1294 19.7714C52.5199 20.0476 53.0355 20.0756 53.4555 19.8438L58.2577 17.1881L63.0599 19.8438C63.2494 19.9486 63.458 20 63.6657 20C63.9184 20 64.1711 19.9232 64.386 19.7714C64.7768 19.4955 64.9769 19.0206 64.9 18.5478L63.9682 12.8405L67.9028 8.80627C68.2294 8.47038 68.3418 7.98082 68.1929 7.53603Z" fill="#E1CB00" />
              <path d="M92.3216 7.53603C92.1724 7.09188 91.7879 6.76805 91.325 6.69725L85.9377 5.87402L83.5179 0.719093C83.3115 0.2797 82.8705 0 82.386 0C81.9013 0 81.4606 0.2797 81.2542 0.719093L78.8341 5.87434L73.4467 6.69757C72.9839 6.76837 72.5994 7.09188 72.4505 7.53635C72.3016 7.98082 72.414 8.47038 72.7413 8.80627L76.6755 12.8405L75.7437 18.5478C75.6669 19.0203 75.8672 19.4952 76.258 19.7714C76.6485 20.0476 77.1641 20.0756 77.5842 19.8438L82.3864 17.1881L87.1886 19.8438C87.3781 19.9486 87.5867 20 87.7943 20C88.047 20 88.2998 19.9232 88.5147 19.7714C88.9055 19.4955 89.1055 19.0206 89.0287 18.5478L88.0969 12.8405L92.0314 8.80627C92.3581 8.47038 92.4705 7.98082 92.3216 7.53603Z" fill="#E1CB00" />
              <path d="M116.45 7.53603C116.3 7.09188 115.916 6.76805 115.453 6.69725L110.066 5.87402L107.646 0.719093C107.439 0.2797 106.998 0 106.514 0C106.029 0 105.589 0.2797 105.382 0.719093L102.962 5.87434L97.5747 6.69757C97.1118 6.76837 96.7273 7.09188 96.5784 7.53635C96.4295 7.98082 96.5419 8.47038 96.8692 8.80627L100.803 12.8405L99.8717 18.5478C99.7948 19.0203 99.9952 19.4952 100.386 19.7714C100.776 20.0476 101.292 20.0756 101.712 19.8438L106.514 17.1881L111.317 19.8438C111.506 19.9486 111.715 20 111.922 20C112.175 20 112.428 19.9232 112.643 19.7714C113.033 19.4955 113.233 19.0206 113.157 18.5478L112.225 12.8405L116.159 8.80627C116.486 8.47038 116.598 7.98082 116.45 7.53603Z" fill="#E1CB00" />
              <path d="M19.9359 7.53603C19.7866 7.09188 19.4022 6.76805 18.9393 6.69725L13.552 5.87402L11.1321 0.719093C10.9258 0.2797 10.4848 0 10.0003 0C9.51551 0 9.07485 0.2797 8.86849 0.719093L6.44833 5.87434L1.06101 6.69757C0.598121 6.76837 0.213653 7.09188 0.0647542 7.53635C-0.0841441 7.98082 0.0282439 8.47038 0.355566 8.80627L4.28978 12.8405L3.35798 18.5478C3.28115 19.0203 3.48148 19.4952 3.8723 19.7714C4.2628 20.0476 4.77839 20.0756 5.19841 19.8438L10.0006 17.1881L14.8028 19.8438C14.9924 19.9486 15.201 20 15.4086 20C15.6613 20 15.914 19.9232 16.1289 19.7714C16.5198 19.4955 16.7198 19.0206 16.6429 18.5478L15.7111 12.8405L19.6457 8.80627C19.9724 8.47038 20.0848 7.98082 19.9359 7.53603Z" fill="#E1CB00" />
              <path d="M44.0643 7.53603C43.9151 7.09188 43.5306 6.76805 43.0677 6.69725L37.6804 5.87402L35.2605 0.719093C35.0542 0.2797 34.6132 0 34.1287 0C33.6439 0 33.2033 0.2797 32.9969 0.719093L30.5768 5.87434L25.1894 6.69757C24.7265 6.76837 24.3421 7.09188 24.1932 7.53635C24.0443 7.98082 24.1567 8.47038 24.484 8.80627L28.4182 12.8405L27.4864 18.5478C27.4096 19.0203 27.6099 19.4952 28.0007 19.7714C28.3912 20.0476 28.9068 20.0756 29.3268 19.8438L34.129 17.1881L38.9313 19.8438C39.1208 19.9486 39.3294 20 39.537 20C39.7897 20 40.0424 19.9232 40.2574 19.7714C40.6482 19.4955 40.8482 19.0206 40.7714 18.5478L39.8396 12.8405L43.7741 8.80627C44.1008 8.47038 44.2132 7.98082 44.0643 7.53603Z" fill="#E1CB00" />
            </svg>

            <p className='font-bold text-xl my-4'>R$ {product.price.toFixed(2)}</p>

            {/* Consultar Frete */}
            <div className='flex items-center gap-2 mb-4'>
              <svg height="22" width="22" fill="none" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
                <path d="M14.5777 2.38197L16.5777 3.43152C18.7294 4.56066 19.8052 5.12523 20.4026 6.13974C21 7.15425 21 8.41667 21 10.9415V11.0585C21 13.5833 21 14.8458 20.4026 15.8603C19.8052 16.8748 18.7294 17.4393 16.5777 18.5685L14.5777 19.618C12.8221 20.5393 11.9443 21 11 21C10.0557 21 9.1779 20.5393 7.42229 19.618L5.42229 18.5685C3.27063 17.4393 2.19479 16.8748 1.5974 15.8603C1 14.8458 1 13.5833 1 11.0585V10.9415C1 8.41667 1 7.15425 1.5974 6.13974C2.19479 5.12523 3.27063 4.56066 5.42229 3.43152L7.42229 2.38197C9.1779 1.46066 10.0557 1 11 1C11.9443 1 12.8221 1.46066 14.5777 2.38197Z" stroke="#9CA3AF" strokeLinecap="round" strokeWidth="2" />
                <path d="M20 6.5L16 8.5M16 8.5C16 8.5 15.6953 8.65237 15.5 8.75C13.7426 9.6287 11 11 11 11M16 8.5V12M16 8.5L6.5 3.5M11 11L2 6.5M11 11V20.5" stroke="#9CA3AF" strokeLinecap="round" strokeWidth="2" />
              </svg>
              <span className='text-gray-400 font-light text-sm'>Consulte o frete no anúncio principal</span>
            </div>

            <div className='flex justify-start items-center my-8 space-x-6'>
              <button className='hover:scale-110 duration-300 border-2 border-blackcontent rounded-tl-[90px] h-[50px] rounded-tr-md rounded-bl-md rounded-br-[90px] '>
                <a className='px-8 font-bold' href={product.permalink} target="_blank" rel="noopener noreferrer">
                  Comprar agora
                </a>
              </button>
              {/* Buttão de adicionar carrinho: */}
              <button onClick={handleAddToCart} className='hover:scale-110 duration-300 border-2 border-blackcontent rounded-full w-[60px] h-[50px] '>
                <div className='flex justify-center'>
                  <svg height="22" width="22" fill="none" viewBox="0 0 17 17" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 2.66667L14.3333 8.5H4.64726M15.1667 11.8333H5.16667L3.5 1H1M11.8333 3.08333H9.75M9.75 3.08333H7.66667M9.75 3.08333V5.16667M9.75 3.08333V1M6 15.1667C6 15.6269 5.6269 16 5.16667 16C4.70643 16 4.33333 15.6269 4.33333 15.1667C4.33333 14.7064 4.70643 14.3333 5.16667 14.3333C5.6269 14.3333 6 14.7064 6 15.1667ZM15.1667 15.1667C15.1667 15.6269 14.7936 16 14.3333 16C13.8731 16 13.5 15.6269 13.5 15.1667C13.5 14.7064 13.8731 14.3333 14.3333 14.3333C14.7936 14.3333 15.1667 14.7064 15.1667 15.1667Z" stroke="#1F1F1F" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" />
                  </svg>
                </div>
              </button>

            </div>

            {/* SVG Payments */}
            <div className='max-sm:flex justify-center items-center'>
              <svg className='my-4' height="19" width="69" fill="none" viewBox="0 0 69 19" xmlns="http://www.w3.org/2000/svg">
                <path d="M36.6964 13.7693C36.3723 13.7701 36.0513 13.7021 35.7519 13.5693C35.4524 13.4364 35.1805 13.2414 34.9518 12.9953L32.432 10.2953C32.3428 10.2045 32.2244 10.1539 32.1014 10.1539C31.9784 10.1539 31.86 10.2045 31.7708 10.2953L29.2414 13.0056C29.0128 13.2518 28.7409 13.4469 28.4414 13.5798C28.1419 13.7126 27.8209 13.7805 27.4968 13.7796H27L30.1917 17.1996C31.1877 18.2668 32.8039 18.2668 33.7999 17.1996L37 13.7693H36.6964ZM27.4968 4.21904C28.1567 4.21904 28.7759 4.49418 29.2414 4.99304L31.7708 7.70333C31.8143 7.74998 31.8659 7.78699 31.9227 7.81224C31.9796 7.83749 32.0405 7.85049 32.102 7.85049C32.1635 7.85049 32.2244 7.83749 32.2813 7.81224C32.3381 7.78699 32.3897 7.74998 32.4332 7.70333L34.953 5.00333C35.1815 4.75734 35.4532 4.5623 35.7524 4.42945C36.0517 4.2966 36.3725 4.22859 36.6964 4.22933H37L33.7999 0.800318C33.3213 0.287864 32.6724 0 31.9958 0C31.3192 0 30.6703 0.287864 30.1917 0.800318L27 4.22032L27.4968 4.21904Z" fill="black" />
                <path d="M40.1996 7.07398L38.1269 5.00897C38.0803 5.028 38.0306 5.038 37.9803 5.03843H37.0378C36.5505 5.03843 36.0734 5.23571 35.7301 5.57902L33.0299 8.26918C32.9098 8.38944 32.7671 8.48487 32.6099 8.55C32.4527 8.61512 32.2841 8.64864 32.1138 8.64864C31.9435 8.64864 31.7749 8.61512 31.6177 8.55C31.4605 8.48487 31.3177 8.38944 31.1977 8.26918L28.4872 5.56749C28.1394 5.22246 27.669 5.02818 27.1782 5.0269H26.021C25.973 5.02652 25.9255 5.0174 25.8808 5L23.8004 7.07398C22.7332 8.13723 22.7332 9.86277 23.8004 10.9273L25.8808 13C25.925 12.9823 25.9721 12.9727 26.0197 12.9718H27.1782C27.6668 12.9718 28.1426 12.7758 28.4872 12.4325L31.1964 9.73082C31.4436 9.49634 31.7718 9.36555 32.1132 9.36555C32.4545 9.36555 32.7827 9.49634 33.0299 9.73082L35.7301 12.421C36.0734 12.7643 36.5505 12.9603 37.0378 12.9603H37.9803C38.0317 12.9603 38.0819 12.9731 38.1269 12.991L40.1996 10.926C41.2668 9.86277 41.2668 8.13723 40.1996 7.07398Z" fill="black" />
                <path d="M1.00489 15.086C0.959966 10.2029 1.12176 5.31879 0.926938 0.438051C0.904284 -0.129397 -0.0224493 -0.0976811 0.000416232 0.469978C0.195451 5.35072 0.0334019 10.2349 0.0783709 15.1178C0.0834098 15.6861 1.00997 15.6532 1.00489 15.086Z" fill="black" />
                <path d="M5.79413 0.429705C5.77143 -0.137742 4.8447 -0.106239 4.86761 0.461632C5.06272 5.34237 4.90038 10.2268 4.94556 15.1094C4.95081 15.678 5.87733 15.6449 5.87229 15.0776C5.82711 10.1949 5.98895 5.31045 5.79413 0.429705Z" fill="black" />
                <path d="M9.58082 15.0712C9.53585 10.1883 9.69778 5.30399 9.50274 0.423246C9.48017 -0.144074 8.55344 -0.112359 8.57635 0.455173C8.77147 5.33591 8.60925 10.2203 8.6543 15.1032C8.65947 15.6713 9.58599 15.6384 9.58082 15.0712Z" fill="black" />
                <path d="M7.69255 15.083C7.61235 10.2014 7.67997 5.32034 7.49281 0.439388C7.47109 -0.12806 6.81002 -0.105575 6.83183 0.462084C7.01899 5.34304 6.95136 10.2242 7.03156 15.1058C7.04079 15.6741 7.70178 15.65 7.69255 15.083Z" fill="black" />
                <path d="M17.1513 0.410127C17.1287 -0.15732 16.202 -0.125816 16.2248 0.441927C16.4198 5.32267 16.2577 10.2072 16.3029 15.0899C16.308 15.6584 17.2345 15.6251 17.2296 15.0581C17.1844 10.1751 17.3461 5.29087 17.1513 0.410127Z" fill="black" />
                <path d="M14.4807 0.448978C14.6678 5.32993 14.6003 10.211 14.6805 15.0926C14.6898 15.6609 15.3507 15.637 15.3415 15.07C15.2612 10.1884 15.329 5.30723 15.1417 0.426282C15.12 -0.141165 14.459 -0.118893 14.4807 0.448978Z" fill="black" />
                <path d="M4.01795 15.0808C3.97298 10.1979 4.13503 5.31362 3.93999 0.432879C3.91708 -0.134441 1.8317 -0.10082 1.85418 0.466839C2.0493 5.34758 1.88717 10.2321 1.93214 15.1147C1.93786 15.6831 4.02345 15.6478 4.01795 15.0808Z" fill="black" />
                <path d="M13.5208 15.0643C13.476 10.1814 13.6377 5.29718 13.4429 0.416437C13.4201 -0.150968 10.4077 -0.115738 10.4303 0.451921C10.6253 5.33266 10.4632 10.2168 10.5082 15.0997C10.5135 15.6683 13.5262 15.6315 13.5208 15.0643Z" fill="black" />
                <path d="M1.28999 16.1247C0.59818 15.7533 -0.315554 18.1856 1.29482 18.054C1.73722 18.0179 1.95364 17.7225 1.98493 17.3582C1.99023 17.2959 1.99023 17.2311 1.98493 17.1653C1.94462 16.6732 1.73104 16.3616 1.28999 16.1247ZM1.27132 17.3877C1.26378 17.3957 1.25573 17.4034 1.24756 17.4109C1.24693 17.4109 1.24672 17.4112 1.24672 17.4112C1.25285 17.4013 1.23812 17.4066 1.22995 17.4114C1.22491 17.4101 1.22008 17.4088 1.21144 17.4069C1.16122 17.3959 1.13878 17.3849 1.10351 17.3658C1.02136 17.1684 1.05579 16.9966 1.16393 16.842C1.26361 16.988 1.30477 17.1538 1.29693 17.3426C1.28474 17.361 1.26958 17.3862 1.27132 17.3877Z" fill="black" />
                <path d="M4.28456 16.1247C3.59296 15.7533 2.67901 18.1856 4.28938 18.054C4.7317 18.0179 4.94842 17.7225 4.97963 17.3582C4.985 17.2959 4.98467 17.2311 4.97942 17.1653C4.93919 16.6732 4.72578 16.3616 4.28456 16.1247ZM4.26584 17.3877C4.25809 17.3957 4.24992 17.4034 4.24204 17.4109C4.24111 17.4109 4.24086 17.4112 4.24086 17.4112C4.24729 17.4013 4.2326 17.4066 4.22422 17.4114C4.21914 17.4101 4.21431 17.4088 4.20571 17.4069C4.15549 17.3959 4.13305 17.3849 4.09778 17.3658C4.01567 17.1684 4.05006 16.9966 4.15812 16.842C4.25788 16.988 4.29904 17.1538 4.29133 17.3426C4.27931 17.361 4.26381 17.3862 4.26584 17.3877Z" fill="black" />
                <path d="M7.27909 16.1247C6.58728 15.7533 5.67334 18.1856 7.28392 18.054C7.72599 18.0179 7.94266 17.7225 7.97391 17.3582C7.9792 17.2959 7.9792 17.2311 7.97391 17.1653C7.93343 16.6732 7.7201 16.3616 7.27909 16.1247ZM7.26021 17.3877C7.25246 17.3957 7.2445 17.4034 7.23637 17.4109C7.23573 17.4109 7.23548 17.4112 7.23548 17.4112C7.24171 17.4013 7.22689 17.4066 7.21863 17.4114C7.21346 17.4101 7.20863 17.4088 7.20004 17.4069C7.14995 17.3959 7.12772 17.3849 7.09223 17.3658C7.01009 17.1684 7.04472 16.9966 7.15274 16.842C7.25229 16.988 7.2937 17.1538 7.28574 17.3426C7.27363 17.361 7.25813 17.3862 7.26021 17.3877Z" fill="black" />
                <path d="M10.2731 16.1247C9.58143 15.7533 8.66749 18.1856 10.2781 18.054C10.7204 18.0179 10.9369 17.7225 10.9681 17.3582C10.9734 17.2959 10.9734 17.2311 10.9681 17.1653C10.9279 16.6732 10.7144 16.3616 10.2731 16.1247ZM10.2542 17.3877C10.2469 17.3957 10.2387 17.4034 10.2306 17.4109C10.2299 17.4109 10.2297 17.4112 10.2297 17.4112C10.2357 17.4013 10.2211 17.4066 10.2129 17.4114C10.2075 17.4101 10.203 17.4088 10.1944 17.4069C10.1441 17.3959 10.1217 17.3849 10.0864 17.3658C10.0043 17.1684 10.0387 16.9966 10.1468 16.842C10.2466 16.988 10.2877 17.1538 10.2798 17.3426C10.268 17.361 10.2527 17.3862 10.2542 17.3877Z" fill="black" />
                <path d="M13.2678 16.1247C12.5761 15.7533 11.6622 18.1856 13.2725 18.054C13.715 18.0179 13.9315 17.7225 13.9629 17.3582C13.9681 17.2959 13.9679 17.2311 13.9627 17.1653C13.9223 16.6732 13.709 16.3616 13.2678 16.1247ZM13.2489 17.3877C13.2413 17.3957 13.2332 17.4034 13.2252 17.4109C13.2243 17.4109 13.2241 17.4112 13.2241 17.4112C13.2306 17.4013 13.2158 17.4066 13.2074 17.4114C13.2025 17.4101 13.1975 17.4088 13.1889 17.4069C13.1388 17.3959 13.1162 17.3849 13.0811 17.3658C12.999 17.1684 13.0332 16.9966 13.1414 16.842C13.2411 16.988 13.2822 17.1538 13.2747 17.3426C13.2622 17.361 13.2471 17.3862 13.2489 17.3877Z" fill="black" />
                <path d="M16.2622 16.1247C15.5705 15.7533 14.6564 18.1856 16.2671 18.054C16.7092 18.0179 16.926 17.7225 16.9572 17.3582C16.9625 17.2959 16.9625 17.2311 16.957 17.1653C16.9167 16.6732 16.7032 16.3616 16.2622 16.1247ZM16.2435 17.3877C16.2358 17.3957 16.2281 17.4034 16.2198 17.4109C16.2192 17.4109 16.219 17.4112 16.219 17.4112C16.225 17.4013 16.2104 17.4066 16.202 17.4114C16.1968 17.4101 16.1921 17.4088 16.1835 17.4069C16.1332 17.3959 16.111 17.3849 16.0755 17.3658C15.9934 17.1684 16.028 16.9966 16.1362 16.842C16.2355 16.988 16.277 17.1538 16.2691 17.3426C16.2571 17.361 16.2416 17.3862 16.2435 17.3877Z" fill="black" />
                <path d="M56.8249 12.1562H53.4124" stroke="#1F1F1F" strokeLinecap="round" strokeWidth="2" />
                <path d="M55.1186 9.71875H53.4124" stroke="#1F1F1F" strokeLinecap="round" strokeWidth="2" />
                <path d="M60.2373 10.9375C60.2373 10.1715 60.2373 9.78846 60.4872 9.55048C60.7371 9.3125 61.1392 9.3125 61.9436 9.3125C62.7479 9.3125 63.15 9.3125 63.3999 9.55048C63.6498 9.78846 63.6498 10.1715 63.6498 10.9375C63.6498 11.7035 63.6498 12.0865 63.3999 12.3245C63.15 12.5625 62.7479 12.5625 61.9436 12.5625C61.1392 12.5625 60.7371 12.5625 60.4872 12.3245C60.2373 12.0865 60.2373 11.7035 60.2373 10.9375Z" stroke="#1F1F1F" strokeWidth="2" />
                <path d="M67.0625 8.5C67.0625 5.43587 67.0625 3.90381 66.063 2.9519C65.0635 2 63.4548 2 60.2375 2H56.825C53.6077 2 51.999 2 50.9995 2.9519C50 3.90381 50 5.43587 50 8.5C50 11.5641 50 13.0962 50.9995 14.0481C51.999 15 53.6077 15 56.825 15H60.2375C63.4548 15 65.0635 15 66.063 14.0481C66.6202 13.5173 66.8668 12.8063 66.9759 11.75" stroke="#1F1F1F" strokeLinecap="round" strokeWidth="2" />
                <path d="M50 6.875H54.2656M67.0625 6.875H57.6781" stroke="#1F1F1F" strokeLinecap="round" strokeWidth="2" />
              </svg>
            </div>
          </div>
        </div>
      </div>

      {/*  */}
      <h1 className='text-blackcontent font-semibold text-lg text-center mt-24'>Veja produtos similares...</h1>
      <ProductShowcase quant={8} />

      <div className='mt-28'>
        <CardFeedback />
      </div>

      <Footer />
    </div>
  );
};

export default ProductPage;


