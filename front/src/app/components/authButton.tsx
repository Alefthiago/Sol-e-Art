import { useState, useEffect } from 'react';
import Link from 'next/link';

const parseJwt = (token: string) => {
  try {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(
      atob(base64)
        .split('')
        .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
        .join('')
    );
    return JSON.parse(jsonPayload);
  } catch (error) {
    console.error('Token inválido', error);
    return null;
  }
};

const AuthButton = () => {
  const [isLoggedIn, setIsLoggedIn] = useState(false);

  useEffect(() => {
    const token = localStorage.getItem('token');
    if (token) {
      const decoded = parseJwt(token);
      if (decoded) {
        setIsLoggedIn(true); // usuário logado
      }
    }
  }, []);

  const handleLogout = () => {
    localStorage.removeItem('token'); 
    setIsLoggedIn(false); 
    window.location.href = '/landingpage';
  };

  

  return (
    <div>
      {isLoggedIn ? (
        <>
          <div className=' flex gap-4 max-sm:justify-between'>
            <button className=" text-white border-[1px] rounded-full p-2 px-6 hover:bg-pinks duration-300"> <a href="/userdata">Minha conta</a></button>
            <button onClick={handleLogout} className=" text-white rounded-xl px-4 bg-pinks hover:bg-pink-300 duration-300">Sair</button>
          </div>
        </>
      ) : (
        <div className='cursor-pointer hover:scale-110 hover:bg-pinks active:bg-pinks transition ease-in-out rounded-xl bg-whitegray mr-6 py-1'>
          <Link href="/login" passHref >
            <svg className='mx-4 my-2' width="75" height="23" viewBox="0 0 75 23" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 10.9593C13.4586 10.9593 14.8575 10.3819 15.889 9.35432C16.9204 8.32669 17.4998 6.93292 17.4998 5.47963C17.4998 4.02634 16.9204 2.63258 15.889 1.60495C14.8575 0.577317 13.4586 0 12 0C10.5414 0 9.14246 0.577317 8.11104 1.60495C7.07963 2.63258 6.50018 4.02634 6.50018 5.47963C6.50018 6.93292 7.07963 8.32669 8.11104 9.35432C9.14246 10.3819 10.5414 10.9593 12 10.9593ZM12 13.3668C4.68764 13.3668 0 17.3872 0 19.3447V23H24V19.3447C24 16.9775 19.5622 13.3668 12 13.3668Z" fill="#1F1F1F" />
              <path d="M40.5469 16.7734V18H34.5234V16.7734H40.5469ZM34.8281 6.625V18H33.3203V6.625H34.8281ZM39.75 11.5156V12.7422H34.5234V11.5156H39.75ZM40.4688 6.625V7.85938H34.5234V6.625H40.4688ZM43.6406 11.3516V18H42.1953V9.54688H43.5625L43.6406 11.3516ZM43.2969 13.4531L42.6953 13.4297C42.7005 12.8516 42.7865 12.3177 42.9531 11.8281C43.1198 11.3333 43.3542 10.9036 43.6562 10.5391C43.9583 10.1745 44.3177 9.89323 44.7344 9.69531C45.1562 9.49219 45.6224 9.39062 46.1328 9.39062C46.5495 9.39062 46.9245 9.44792 47.2578 9.5625C47.5911 9.67188 47.875 9.84896 48.1094 10.0938C48.349 10.3385 48.5312 10.6562 48.6562 11.0469C48.7812 11.4323 48.8438 11.9036 48.8438 12.4609V18H47.3906V12.4453C47.3906 12.0026 47.3255 11.6484 47.1953 11.3828C47.0651 11.112 46.875 10.9167 46.625 10.7969C46.375 10.6719 46.0677 10.6094 45.7031 10.6094C45.3438 10.6094 45.0156 10.6849 44.7188 10.8359C44.4271 10.987 44.1745 11.1953 43.9609 11.4609C43.7526 11.7266 43.5885 12.0312 43.4688 12.375C43.3542 12.7135 43.2969 13.0729 43.2969 13.4531ZM54.5781 9.54688V10.6562H50.0078V9.54688H54.5781ZM51.5547 7.49219H53V15.9062C53 16.1927 53.0443 16.4089 53.1328 16.5547C53.2214 16.7005 53.3359 16.7969 53.4766 16.8438C53.6172 16.8906 53.7682 16.9141 53.9297 16.9141C54.0495 16.9141 54.1745 16.9036 54.3047 16.8828C54.4401 16.8568 54.5417 16.8359 54.6094 16.8203L54.6172 18C54.5026 18.0365 54.3516 18.0703 54.1641 18.1016C53.9818 18.138 53.7604 18.1562 53.5 18.1562C53.1458 18.1562 52.8203 18.0859 52.5234 17.9453C52.2266 17.8047 51.9896 17.5703 51.8125 17.2422C51.6406 16.9089 51.5547 16.4609 51.5547 15.8984V7.49219ZM57.7188 10.875V18H56.2734V9.54688H57.6797L57.7188 10.875ZM60.3594 9.5L60.3516 10.8438C60.2318 10.8177 60.1172 10.8021 60.0078 10.7969C59.9036 10.7865 59.7839 10.7812 59.6484 10.7812C59.3151 10.7812 59.0208 10.8333 58.7656 10.9375C58.5104 11.0417 58.2943 11.1875 58.1172 11.375C57.9401 11.5625 57.7995 11.7865 57.6953 12.0469C57.5964 12.3021 57.5312 12.5833 57.5 12.8906L57.0938 13.125C57.0938 12.6146 57.1432 12.1354 57.2422 11.6875C57.3464 11.2396 57.5052 10.8438 57.7188 10.5C57.9323 10.151 58.2031 9.88021 58.5312 9.6875C58.8646 9.48958 59.2604 9.39062 59.7188 9.39062C59.8229 9.39062 59.9427 9.40365 60.0781 9.42969C60.2135 9.45052 60.3073 9.47396 60.3594 9.5ZM66.3672 16.5547V12.2031C66.3672 11.8698 66.2995 11.5807 66.1641 11.3359C66.0339 11.0859 65.8359 10.8932 65.5703 10.7578C65.3047 10.6224 64.9766 10.5547 64.5859 10.5547C64.2214 10.5547 63.901 10.6172 63.625 10.7422C63.3542 10.8672 63.1406 11.0312 62.9844 11.2344C62.8333 11.4375 62.7578 11.6562 62.7578 11.8906H61.3125C61.3125 11.5885 61.3906 11.2891 61.5469 10.9922C61.7031 10.6953 61.9271 10.4271 62.2188 10.1875C62.5156 9.94271 62.8698 9.75 63.2812 9.60938C63.6979 9.46354 64.1615 9.39062 64.6719 9.39062C65.2865 9.39062 65.8281 9.49479 66.2969 9.70312C66.7708 9.91146 67.1406 10.2266 67.4062 10.6484C67.6771 11.0651 67.8125 11.5885 67.8125 12.2188V16.1562C67.8125 16.4375 67.8359 16.737 67.8828 17.0547C67.9349 17.3724 68.0104 17.6458 68.1094 17.875V18H66.6016C66.5286 17.8333 66.4714 17.612 66.4297 17.3359C66.388 17.0547 66.3672 16.7943 66.3672 16.5547ZM66.6172 12.875L66.6328 13.8906H65.1719C64.7604 13.8906 64.3932 13.9245 64.0703 13.9922C63.7474 14.0547 63.4766 14.151 63.2578 14.2812C63.0391 14.4115 62.8724 14.5755 62.7578 14.7734C62.6432 14.9661 62.5859 15.1927 62.5859 15.4531C62.5859 15.7188 62.6458 15.9609 62.7656 16.1797C62.8854 16.3984 63.0651 16.5729 63.3047 16.7031C63.5495 16.8281 63.849 16.8906 64.2031 16.8906C64.6458 16.8906 65.0365 16.7969 65.375 16.6094C65.7135 16.4219 65.9818 16.1927 66.1797 15.9219C66.3828 15.651 66.4922 15.388 66.5078 15.1328L67.125 15.8281C67.0885 16.0469 66.9896 16.2891 66.8281 16.5547C66.6667 16.8203 66.4505 17.0755 66.1797 17.3203C65.9141 17.5599 65.5964 17.7604 65.2266 17.9219C64.862 18.0781 64.4505 18.1562 63.9922 18.1562C63.4193 18.1562 62.9167 18.0443 62.4844 17.8203C62.0573 17.5964 61.724 17.2969 61.4844 16.9219C61.25 16.5417 61.1328 16.1172 61.1328 15.6484C61.1328 15.1953 61.2214 14.7969 61.3984 14.4531C61.5755 14.1042 61.8307 13.8151 62.1641 13.5859C62.4974 13.3516 62.8984 13.1745 63.3672 13.0547C63.8359 12.9349 64.3594 12.875 64.9375 12.875H66.6172ZM71.5312 10.875V18H70.0859V9.54688H71.4922L71.5312 10.875ZM74.1719 9.5L74.1641 10.8438C74.0443 10.8177 73.9297 10.8021 73.8203 10.7969C73.7161 10.7865 73.5964 10.7812 73.4609 10.7812C73.1276 10.7812 72.8333 10.8333 72.5781 10.9375C72.3229 11.0417 72.1068 11.1875 71.9297 11.375C71.7526 11.5625 71.612 11.7865 71.5078 12.0469C71.4089 12.3021 71.3438 12.5833 71.3125 12.8906L70.9062 13.125C70.9062 12.6146 70.9557 12.1354 71.0547 11.6875C71.1589 11.2396 71.3177 10.8438 71.5312 10.5C71.7448 10.151 72.0156 9.88021 72.3438 9.6875C72.6771 9.48958 73.0729 9.39062 73.5312 9.39062C73.6354 9.39062 73.7552 9.40365 73.8906 9.42969C74.026 9.45052 74.1198 9.47396 74.1719 9.5Z" fill="#1F1F1F" />
            </svg>
          </Link>
        </div>
      )}
    </div>
  );
};

export default AuthButton;


